# ChatGPT API連携設定ガイド

## 📋 概要

このシステムでは、Supabase Edge Functionを経由してChatGPT（OpenAI API）と連携し、業務データに基づいた高度なAI分析を提供します。

## 🔑 手順1: OpenAI APIキーの取得

1. [OpenAI Platform](https://platform.openai.com/api-keys) にアクセス
2. アカウント作成またはログイン
3. **Create new secret key** をクリック
4. キー名を入力（例：「restaurant-system」）
5. 生成されたAPIキーをコピー（`sk-` で始まる文字列）

⚠️ **重要**: APIキーは一度しか表示されないため、必ずコピーして安全に保管してください。

## ⚙️ 手順2: Supabaseでの環境変数設定

### Option A: Supabaseダッシュボード（推奨）
1. [Supabase Dashboard](https://supabase.com/dashboard) でプロジェクトを開く
2. **Settings** → **API** → **Environment Variables** をクリック
3. **Add new variable** で以下を追加：
   - **Name**: `OPENAI_API_KEY`
   - **Value**: 取得したOpenAI APIキー（`sk-...`）
4. **Save** をクリック

### Option B: ローカル開発環境
```bash
# .env ファイルに追加
OPENAI_API_KEY=sk-your-actual-openai-api-key-here
```

## 🚀 手順3: Edge Functionのデプロイ

Edge Functionは自動的にデプロイされます。以下の機能が利用可能になります：

### 🤖 AI機能
- **高度な分析**: ChatGPTによる詳細なデータ分析
- **経営コンサルティング**: 業界知識を活用した提案
- **予測分析**: 売上・利益の将来予測
- **改善提案**: 具体的なアクションプラン

### 📊 データ連携
- リアルタイム業績データの自動送信
- 店舗別・期間別の詳細分析
- 特別実績（豊洲店9/18等）の認識
- 業界標準との比較分析

## 🧪 手順4: 接続テスト

1. AIチャットページを開く
2. 「今月の業績を分析して」と入力
3. 以下のいずれかが表示されます：
   - ✅ **ChatGPT分析**: 本格的なAI分析
   - 🤖 **ローカル分析モード**: フォールバック機能

## 💰 料金について

- **OpenAI API**: 使用量に応じた課金
- **GPT-4o-mini**: 安価で高性能（推奨）
- **GPT-4**: より高度だが高額
- **想定月額**: 100-500円程度（通常利用）

## ❌ トラブルシューティング

### 「APIキーが設定されていません」
- Supabase環境変数の設定を確認
- APIキーの形式確認（`sk-` で始まる）

### 「API利用制限に達しました」
- OpenAIアカウントの利用制限を確認
- プリペイド残高または請求設定を確認

### 「ローカル分析モードで対応」
- 一時的なAPI障害（自動復旧）
- 基本機能は継続利用可能

## 🔒 セキュリティ

- APIキーはサーバーサイド（Edge Function）でのみ使用
- フロントエンドに機密情報は保存されません
- 業務データはOpenAIに学習目的で使用されません

## 🎯 設定完了後の機能

### 高度なAI分析が可能に
- 「売上を20%向上させる具体的な方法を教えて」
- 「豊洲店の9月18日の成功要因を分析して」  
- 「来月の売上予測と必要な対策を提案して」
- 「競合対策を含めた包括的な戦略を立てて」

---

**設定完了後は、プロフェッショナルレベルのAI経営コンサルティングをご利用いただけます！** 🚀