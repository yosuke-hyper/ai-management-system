# デプロイチェックリスト

本番環境へのデプロイ前に、以下のチェックリストを確認してください。

## ✅ デプロイ前の準備

### 1. アカウント・サービス準備
- [ ] Supabaseアカウント作成済み
- [ ] Vercel または Netlify アカウント作成済み
- [ ] OpenAI API アカウント作成済み
- [ ] GitHubリポジトリ作成済み（推奨）
- [ ] カスタムドメイン取得済み（オプション）

### 2. APIキー・認証情報の取得
- [ ] Supabase Project URL 取得済み
- [ ] Supabase Anon Key 取得済み
- [ ] OpenAI API Key 取得済み
- [ ] Google Sheets API Key 取得済み（オプション）
- [ ] すべてのAPIキーを安全に保管

### 3. コード確認
- [ ] すべての変更をGitにコミット済み
- [ ] 本番用の設定ファイル確認（vercel.json / netlify.toml）
- [ ] .gitignore に機密情報が含まれていないことを確認
- [ ] ローカルでビルドが成功することを確認（`npm run build`）
- [ ] TypeScriptエラーがないことを確認

---

## ✅ Supabaseセットアップ

### 1. プロジェクト作成
- [ ] 本番用Supabaseプロジェクト作成
- [ ] リージョン選択（推奨: Tokyo）
- [ ] データベースパスワード保管
- [ ] プロジェクトURL・APIキーをコピー

### 2. データベース
- [ ] すべてのマイグレーションファイルを順番に実行
- [ ] エラーなく完了したことを確認
- [ ] すべてのテーブルでRLS有効化を確認
- [ ] インデックスが作成されていることを確認
- [ ] 関数・トリガーが正しく動作することを確認

```sql
-- RLS確認クエリ
SELECT tablename, rowsecurity
FROM pg_tables
WHERE schemaname = 'public'
AND tablename NOT LIKE 'pg_%';
```

### 3. 認証設定
- [ ] Email Auth 有効化
- [ ] Email Confirmationの設定（本番では有効推奨）
- [ ] Site URL設定（デプロイ後のURL）
- [ ] Redirect URLs設定
- [ ] パスワードポリシー確認

### 4. Edge Functions
- [ ] chat-gpt 関数デプロイ
- [ ] generate-ai-report 関数デプロイ
- [ ] scheduled-report-generator 関数デプロイ
- [ ] send-report-email 関数デプロイ
- [ ] sync-to-sheets 関数デプロイ
- [ ] 各関数の環境変数設定（OPENAI_API_KEY等）

### 5. セキュリティ設定
- [ ] RLSポリシーの動作テスト
- [ ] 組織間データ分離の確認
- [ ] API Rate Limitの設定
- [ ] 不正アクセス対策の確認

---

## ✅ デプロイ設定

### Vercel の場合
- [ ] GitHubリポジトリをインポート
- [ ] ビルド設定確認（Framework: Vite）
- [ ] 環境変数をすべて設定
  - [ ] VITE_DEMO_MODE=false
  - [ ] VITE_USE_SUPABASE=true
  - [ ] VITE_SUPABASE_URL
  - [ ] VITE_SUPABASE_ANON_KEY
  - [ ] VITE_OPENAI_API_KEY
  - [ ] NODE_ENV=production
- [ ] 環境変数のスコープ確認（Production/Preview/Development）
- [ ] デプロイ実行
- [ ] デプロイ成功を確認

### Netlify の場合
- [ ] GitHubリポジトリをインポート
- [ ] ビルド設定確認（Build command: npm run build）
- [ ] Publish directory設定（dist）
- [ ] 環境変数をすべて設定
- [ ] netlify.toml 確認
- [ ] デプロイ実行
- [ ] デプロイ成功を確認

---

## ✅ デプロイ後の確認

### 1. 基本動作
- [ ] サイトにHTTPSでアクセスできる
- [ ] ログイン画面が正しく表示される
- [ ] 新規ユーザー登録ができる
- [ ] 利用規約同意モーダルが表示される
- [ ] 利用規約・プライバシーポリシーページが表示される

### 2. 認証フロー
- [ ] メールアドレスでログインできる
- [ ] ログアウトできる
- [ ] セッションが維持される
- [ ] パスワードリセットが機能する
- [ ] 認証エラーが適切に表示される

### 3. データベース機能
- [ ] 組織が自動作成される
- [ ] 店舗を作成できる
- [ ] 日報を作成できる
- [ ] 月次経費を登録できる
- [ ] データが正しく表示される
- [ ] 他組織のデータが見えないことを確認

### 4. 権限管理
- [ ] Admin権限で全機能にアクセスできる
- [ ] Manager権限で適切な制限がかかる
- [ ] Staff権限で適切な制限がかかる
- [ ] 組織招待機能が動作する
- [ ] メンバー管理ができる

### 5. AI機能
- [ ] AIチャットが動作する
- [ ] AIレポート生成が動作する
- [ ] 使用量制限が機能する
- [ ] エラーハンドリングが適切

### 6. UI/UX
- [ ] PCで正しく表示される
- [ ] タブレットで正しく表示される
- [ ] スマートフォンで正しく表示される
- [ ] ダークモード対応（該当する場合）
- [ ] ページ遷移がスムーズ
- [ ] ローディング表示が適切

### 7. パフォーマンス
- [ ] 初回読み込み3秒以内
- [ ] ページ遷移が快適
- [ ] 大量データでも動作する
- [ ] Lighthouse スコア確認（70以上推奨）

### 8. セキュリティ
- [ ] HTTPSで接続される
- [ ] APIキーがクライアントに露出していない
- [ ] XSS対策が有効
- [ ] CSRF対策が有効
- [ ] セキュリティヘッダーが設定されている
- [ ] RLSが全テーブルで機能している

---

## ✅ 運用準備

### 1. 初期データ投入
- [ ] 管理者アカウント作成
- [ ] 店舗情報登録
- [ ] 業者情報登録
- [ ] 初期目標値設定
- [ ] テストデータの削除

### 2. 監視設定
- [ ] Supabaseの監視ダッシュボード確認
- [ ] OpenAI使用量アラート設定
- [ ] エラートラッキング（Sentry等）設定
- [ ] アップタイム監視設定
- [ ] バックアップ設定確認

### 3. ドキュメント
- [ ] 運用マニュアル作成
- [ ] ユーザーマニュアル作成
- [ ] FAQ作成
- [ ] トラブルシューティングガイド作成
- [ ] 緊急連絡先リスト作成

### 4. サポート体制
- [ ] 問い合わせ窓口設定
- [ ] サポート対応フロー確立
- [ ] エスカレーションルール確立
- [ ] バグ報告フロー確立

### 5. バックアップ・復旧
- [ ] 自動バックアップ設定確認
- [ ] バックアップからの復旧テスト
- [ ] 災害復旧計画（DRP）策定
- [ ] データエクスポート手順確認

---

## ✅ セキュリティ最終確認

### 認証・認可
- [ ] すべてのテーブルでRLS有効
- [ ] 適切なRLSポリシー設定
- [ ] 組織間データ分離確認
- [ ] 権限別アクセス制御確認

### APIセキュリティ
- [ ] service_role_key がクライアントに含まれていない
- [ ] APIキーの使用量制限設定
- [ ] Rate Limiting設定
- [ ] CORS設定確認

### データ保護
- [ ] データ暗号化確認（保存時・転送時）
- [ ] 個人情報の適切な取扱い
- [ ] ログの適切な保管
- [ ] データ保持期間の設定

---

## ✅ 法的対応

- [ ] 利用規約の内容確認（法的レビュー推奨）
- [ ] プライバシーポリシーの内容確認
- [ ] 個人情報取扱事業者としての届出（必要に応じて）
- [ ] 特定商取引法対応（有料サービスの場合）
- [ ] GDPRコンプライアンス確認（EU向けの場合）

---

## ✅ 最終確認

### デプロイ直前
- [ ] すべての環境変数が正しく設定されている
- [ ] 本番環境の認証情報が漏洩していない
- [ ] テストアカウントが削除されている
- [ ] デバッグログが無効化されている
- [ ] 本番用のドメインが設定されている

### リリース判断
- [ ] すべての機能が正常動作している
- [ ] 致命的なバグがない
- [ ] パフォーマンスが許容範囲内
- [ ] セキュリティリスクが最小化されている
- [ ] ユーザーマニュアルが準備されている
- [ ] サポート体制が整っている

### リリース後
- [ ] ユーザーに通知（該当する場合）
- [ ] 監視ダッシュボードを確認
- [ ] エラーログを監視
- [ ] ユーザーフィードバックを収集
- [ ] 問題発生時の対応準備

---

## 📞 緊急連絡先

### サービス障害時
1. Supabase Status: https://status.supabase.com
2. Vercel Status: https://www.vercelstatus.com
3. OpenAI Status: https://status.openai.com

### サポート
- 開発チーム: [連絡先]
- インフラ担当: [連絡先]
- セキュリティ担当: [連絡先]

---

## 📝 デプロイ記録

### デプロイ情報
- デプロイ日時: _______________
- デプロイ担当者: _______________
- 環境: Production
- バージョン: _______________
- コミットハッシュ: _______________

### 確認者
- 機能テスト: _______________ ✓
- セキュリティレビュー: _______________ ✓
- パフォーマンステスト: _______________ ✓
- 最終承認: _______________ ✓

---

**このチェックリストを印刷して、すべての項目を確認しながらデプロイ作業を進めてください。**
